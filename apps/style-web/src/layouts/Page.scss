@use "@kth/style/scss/tokens/spacing";
@use "@kth/style/scss/tokens/icons";
@use "@kth/style/scss/utils/reset";
@use "@kth/style/scss/utils/prose";

@use "@kth/style/scss/components/a11y-nav";
@use "@kth/style/scss/components/menu-item";
@use "@kth/style/scss/components/menu-panel";
@use "@kth/style/scss/components/header";
@use "@kth/style/scss/components/logotype";
@use "@kth/style/scss/components/mega-menu";
@use "@kth/style/scss/components/search";
@use "@kth/style/scss/components/button";
@use "@kth/style/scss/components/visually-hidden";
@use "@kth/style/scss/components/menu-panel__content";

//
@use "@kth/style/scss/components/kpm";
@use "@kth/style/scss/components/personal-menu";
@use "@kth/style/scss/components/entrances";
@use "@kth/style/scss/components/details" with (
  $generate-css: false
);

// Internal components
@use "@components/content.scss";
@use "@components/local-navigation.scss";

// TODO: this should be a token
$breakpoint-mega-menu: 64rem;

main {
  @include prose.prose;
  margin-inline: auto;
  max-width: 40rem;
  width: 100%;

  iframe {
    width: 100%;
    // max-width: 100%;
    aspect-ratio: 16 / 9;
    border: solid black 1px;
    resize: auto;
  }

  .markdown-alert {
    margin-inline-start: spacing.$space-8;
    border-inline-start-width: spacing.$space-4;
    border-inline-start-style: solid;
    padding-inline-start: spacing.$space-16;

    &.note {
      border-color: var(--color-primary);

      .markdown-alert-title {
        font: var(--font-label-s);
        color: var(--color-primary);
      }
    }
  }

  .markdown-alert-content p:first-child {
    margin-block-start: spacing.$space-4;
  }

  // All instances of <details> are using the KTH Style details.
  // We don't write the "kth-details" class.
  details {
    @include details.details;
  }
}

:root {
  --kth-header-box-shadow-offset-block: min(
    calc(var(--kth-scroll-block, 0) * 1rem),
    0.125rem
  );
  --kth-header-box-shadow-blur-radius: min(
    calc(var(--kth-scroll-block, 0) * 1rem),
    0.25rem
  );

  --kth-header-box-shadow: 0 var(--kth-header-box-shadow-offset-block)
    var(--kth-header-box-shadow-blur-radius) rgba(33 33 33 / 0.1);
}

// In desktop, show always the shadow in KPM
.kth-kpm {
  box-shadow: var(--kth-header-box-shadow);
}

@media (max-width: $breakpoint-mega-menu) {
  .kth-header {
    position: fixed;
    inline-size: 100%;
    inset-block-start: 0;
    padding-block: clamp(
      0.25rem,
      calc(1.25rem - var(--kth-scroll-block) * 1rem),
      1rem
    );
  }

  .kth-content {
    margin-block-start: 8.5rem;
  }

  .kth-logotype {
    block-size: calc((1 - var(--kth-scroll-block)) * 3rem);

    > figure {
      opacity: calc(1 - var(--kth-scroll-block, 0));
    }
  }

  .kth-header {
    box-shadow: var(--kth-header-box-shadow);
  }

  .kth-kpm {
    box-shadow: none;
  }

  // In mobile, show shadow in kpm only if there is no .kth-header
  body:not(:has(.kth-header)) .kth-kpm {
    box-shadow: var(--kth-header-box-shadow);
  }
}
