---
import {
  getLangFromUrl,
  getTranslatedLink,
  useTranslations,
} from "src/i18n/utils";
import MainHeaderLogotype from "./Logotype.astro";
import NavigationPanel from "./NavigationPanel.astro";
import NavigationPanelMobile from "./NavigationPanelMobile.astro";
import SearchPanel from "./SearchPanel.astro";

const lang = getLangFromUrl(Astro.url);
const navigationPanel = [
  {
    dataId: "1.575942",
    labels: {
      en: "My employment",
      sv: "Din anställning",
    },
  },
  {
    dataId: "1.575949",
    labels: {
      en: "Support & Service",
      sv: "Stöd och service",
    },
  },
  {
    dataId: "1.1067969",
    labels: {
      en: "Education",
      sv: "Utbilda",
    },
  },
  {
    dataId: "1.1067196",
    labels: {
      en: "Research",
      sv: "Forska",
    },
  },
  {
    dataId: "1.575952",
    labels: {
      en: "Organisation & Regulations",
      sv: "Orgasnisation och styrning",
    },
  },
];

const translatedLink = getTranslatedLink(Astro.url);
const t = useTranslations(lang);
---

<header class="kth-header intranet">
  <div class="kth-header__container">
    <MainHeaderLogotype alt={t("nav.go-home")} />
    <nav class="kth-mega-menu">
      <ul>
        {
          navigationPanel.map(({ dataId, labels }) => (
            <li>
              <NavigationPanel dataId={dataId} label={labels[lang]} />
            </li>
          ))
        }
      </ul>
    </nav>

    <ul class="kth-header__tools">
      <li>
        <SearchPanel />
      </li>
      <li>
        <a
          href={translatedLink.url}
          lang={translatedLink.lang}
          class="kth-menu-item language"
        >
          <span>{translatedLink.label}</span>
        </a>
      </li>
      <li>
        <nav class="kth-mega-menu--collapsable">
          <button class="kth-menu-item menu">
            <span>{t("nav.menu")}</span>
          </button>
          <dialog class="kth-menu-panel--modal">
            <!-- -->
            <button class="kth-button close">
              <span class="kth-visually-hidden">{t("close")}</span>
            </button>
            <div class="kth-menu-panel__content">
              <h2>{t("nav.menu")}</h2>
              <ul>
                {
                  navigationPanel.map(({ labels, dataId }) => (
                    <NavigationPanelMobile
                      label={labels[lang]}
                      dataId={dataId}
                    />
                  ))
                }
              </ul>

              <ul class="kth-menu-panel__entries">
                <li><a href="https://kth.se">kth.se</a></li>
                <li>
                  <a href="https://kth.se/student">{t("sites.student-web")}</a>
                </li>
                <li>
                  <a href="https://intra.kth.se">{t("sites.intranet")}</a>
                </li>
              </ul>
            </div>
          </dialog>
        </nav>
      </li>
    </ul>
  </div>
</header>

<script>
  import { MenuPanel } from "@kth/style";

  // Set navigationPanels only to non-mobile versions
  MenuPanel.init(
    document.querySelector(".kth-header"),
    document.querySelectorAll(".kth-mega-menu .kth-menu-item"),
  );
  MenuPanel.init(
    document.querySelector(".kth-header"),
    document.querySelectorAll(".kth-menu-item.search"),
  );

  MenuPanel.initModal(
    document.querySelectorAll(".kth-mega-menu--collapsable .kth-menu-item"),
  );
  MenuPanel.initModal(
    document.querySelectorAll(
      ".kth-mega-menu--collapsable .kth-menu-item--modal",
    ),
  );
</script>
